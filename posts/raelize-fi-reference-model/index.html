<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.75.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Fault Injection Reference Model (FIRM)&nbsp;&ndash;&nbsp;</title><link rel="stylesheet" href="/css/core.min.0b9416c1ab7ad80e65b9c8c02a08c0bc1ccc6239d624b16fd01f9ec0d401727ffe61878c75525c2bb300f182d0c722f2.css" integrity="sha384-C5QWwat62A5lucjAKgjAvBzMYjnWJLFv0B&#43;ewNQBcn/&#43;YYeMdVJcK7MA8YLQxyLy"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Fault Injection Reference Model (FIRM)" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/img/logo.png" alt /><span class="site name"></span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/">Home</a><a class="nav item" href="/about">About</a><a class="nav item" href="/services">Services</a><a class="nav item" href="/training">Training</a><a class="nav item" href="/blog">Blog</a><a class="nav item" href="/contact">Contact</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Fault Injection Reference Model (FIRM)</h1><p class="article date">Wednesday, August 26, 2020</p></section><article class="article markdown-body"><p>In today's world, physical access to a device is considered a significant threat as devices often play a central role for the underlying business model. A multitude of assets, intellectual property (IP) and even the devices themselves have become sufficiently valuable to require adequate protection.</p>
<p>This gave rise to security features specifically designed to mitigate threats related to physical access. These type of security features, for example <strong>Secure Boot</strong>, are nowadays way more common than they used to be just a handful of years ago.</p>
<p>Nonetheless, modern device hackers did not give up, often resorting to powerful techniques like <strong>Fault Injection (FI)</strong> in order to circumvent these new defenses. For example, most of the latest gaming consoles, if not all, have been initially hacked successfully using a wide variety of <strong>FI</strong> attacks in order to <a href="https://media.ccc.de/v/c4.openchaos.2018.06.glitching-the-switch"target="_blank">achieve code execution</a>, <a href="https://rdist.root.org/2010/01/27/how-the-ps3-hypervisor-was-hacked/"target="_blank">escalate privileges</a> or <a href="https://yifan.lu/2019/02/22/attacking-hardware-aes-with-dfa/"target="_blank">extract cryptographic keys</a>.</p>
<p>At the same time, lots of research has been published where <strong>FI</strong> theoretics and practicalities are discussed and demonstrated. We have been specifically active in this field, for example demonstrating that <strong>FI</strong> is an efficient technique for <a href="https://raelize.com/upload/research/2016/2016_BlackHat-EU_Bypassing-Secure-Boot-Using-Fault-Injection_NT-AS.pdf"target="_blank">bypassing Secure Boot</a> and <a href="https://raelize.com/upload/research/2017/2017_FDTC_Escalating-Privileges-in-Linux-using-Fault-Injection_NT-CM.pdf"target="_blank">escalating privileges on Linux</a>.</p>
<p>We expect that <strong>FI</strong> attacks will become even more relevant in the future as more devices will implement defenses to prevent easy access to device internals.</p>
<h2 id="background">Background</h2>
<p>The basic concept of <strong>FI</strong> is actually quite straightforward. Simply said, it often boils down to using specialized tooling for injecting a glitch at a specific moment in time into a vulnerable target. Some call it magic, while others like to fall back on their understanding of the physics at play.</p>
<p>Actually, most <strong>FI</strong> details are not that easy to discuss, even for seemingly simple attacks. In fact, quite a diverse technical background, spanning multiple domains related to both software and hardware, is usually required to fully digest the matter at hand. Importantly, a thorough understanding of the details is often needed to come up with novel ideas that progress the <strong>FI</strong> research field.</p>
<p>This is something we experienced ourselves in numerous exchanges between us and with others. Discussing <strong>FI</strong> attacks is not always trivial, mostly due to a mix of different backgrounds, levels of understanding and experience. We realized we needed a better method or tool to support reasoning on <strong>FI</strong> attacks and defenses.</p>
<p>We believe that our <strong>Fault Injection Reference Model (FIRM)</strong>, which we introduced already at <a href="https://raelize.com/upload/research/2019/2019_HITB-Cyberweek-UAE_Debunking-Fault-Injection-Myths-and-Misconceptions_CM-NT.pdf"target="_blank">HITB+CyberWeek</a> and <a href="https://raelize.com/upload/using-fault-injection-for-turning-data-transfers-into-arbitrary-execution-poc2019-slides-1.0.pdf"target="_blank">POC2019</a>, does exactly that.</p>
<p>Before we dive into <strong>FIRM</strong> itself, let's align ourselves on what a <strong>FI</strong> vulnerability exactly is and how attackers utilize <strong>FI</strong> for attacks.</p>
<h4 id="what39s-a-fi-vulnerability">What's a FI vulnerability?</h4>
<p>Most attacks, if not all, are applicable due to the presence a vulnerability. Without a vulnerability, it would be hard to differentiate a feature from an actual attack. While software vulnerabilities have been refined conceptually over the years, no comparable effort has been devoted to <strong>FI</strong> vulnerabilities.</p>
<p>Without any attempt to be rigorous or complete, we like to use the following definition for describing a <strong>FI</strong> vulnerability.</p>
<p><i>
<pre><code>&quot;The susceptibility of a hardware subsystem to a specific 
Fault Injection technique, which has an impact on security.&quot; - Raelize
</code></pre><p></i></p></p>
<p>It should already be apparent from the definition itself that bypassing <strong>Secure Boot</strong> using <strong>voltage glitches</strong> entails exploiting a different vulnerability than doing the same using <strong>optical pulses</strong>. Although the achieved goal is identical, the underlying physics and root cause is entirely different. It's important to point out that these differences become extremely relevant during the development of both effective attacks and defenses.</p>
<p>Interestingly, specialized tooling is not always required to trigger <strong>FI</strong> vulnerabilities. Examples are <a href="https://www.usenix.org/system/files/conference/usenixsecurity17/sec17-tang.pdf"target="_blank">CLKSCREW</a> and <a href="http://users.ece.cmu.edu/~yoonguk/papers/kim-isca14.pdf"target="_blank">Rowhammer</a> which both use software to trigger <strong>FI</strong> vulnerabilities. Moreover, these attacks showed that <strong>FI</strong> vulnerabilities are applicable to more than just the CPU alone.</p>
<p>We consider these so-called <em><strong>software-driven</strong></em> attacks to be <strong>FI</strong> attacks and they fit perfectly in <strong>FIRM</strong> as well!</p>
<h4 id="what39s-a-fi-attack">What's a FI attack?</h4>
<p>At a high level, the steps an attacker takes for performing a <strong>FI</strong> attack are quite intuitive. Most <strong>FI</strong> attacks can be summarized as follows:</p>
<ol>
<li>Select a target</li>
<li>Select a <strong>FI</strong> technique</li>
<li>Generate a trigger</li>
<li>Glitch n' pray</li>
<li>Profit</li>
</ol>
<p>For many attacks, there is not much more to it. It would not be the first time the security of a modern chip is completely compromised by using this naive, but straightforward, approach. Nonetheless, seasoned <strong>FI</strong> practitioners know that this process is not always sufficient. At some point the need comes to better understand what exactly is going on.</p>
<p>Regardless if you are an attacker or defender, the nuances of the variables at play become very important when targets are complex or specifically hardened against <strong>FI</strong>. This includes for example the <strong>timing of the glitch</strong>, <strong>the shape of the glitch</strong>, <strong>the impact of the glitch</strong>, <strong>the target's state</strong>, etc.</p>
<p>We raelized we could visualize <strong>FI</strong> attacks, identify their main building blocks and conceptually play with them. Moreover, we could visually break down the attack to discuss specific nuances and details, but also capture common properties at a more abstract level. With time, experience and research the different pieces started falling into place and a reference model formed in our heads.</p>
<p>Simply said, <strong>FIRM</strong> was born.</p>
<h2 id="description-of-firm">Description of FIRM</h2>
<p>We consider six so-called stages of a <strong>FI</strong> attack: <strong>Activate</strong>, <strong>Inject</strong>, <strong>Glitch</strong>, <strong>Fault</strong>, <strong>Exploit</strong> and <strong>Goal</strong>. These stages, or building blocks, are used to break down a <strong>FI</strong> attack in separate steps or events.</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-new.png">
        <img src="/img/fimodel/raelize-fi-fault-model-new.png" width="1000px">
    </a>
</p>
<p>From an attacker's point of view, at the start, there are several choices to be made. These are likely steered mostly by attacker's capabilities (i.e. what tooling or expertise is available) and the characteristics of the target (i.e. some <strong>FI</strong> techniques may be difficult to apply).</p>
<ul>
<li>The <strong>Activate</strong> stage applies to the <strong>FI</strong> technique, whether driven by software or hardware, that is used.</li>
<li>The <strong>Inject</strong> stage applies to the environmental domain affected by the <strong>FI</strong> technique.</li>
<li>The <strong>Glitch</strong> stage applies to the parameters that can shape the glitch used to trigger the <strong>FI</strong> vulnerability in the target.</li>
</ul>
<p>The above stages encompass what is required during the <strong>FI</strong> attack in order to trigger the <strong>FI</strong> vulnerability. The remaining stages are related to what can be accomplished once the <strong>FI</strong> vulnerability is triggered.</p>
<ul>
<li>The <strong>Fault</strong> stage applies to the type of faults that are introduced as a consequence of the <strong>FI</strong> vulnerability. These so-called <strong>Fault Models</strong> describe the behavioral impact (i.e. fault) a glitch has on a target (e.g. instruction skipping, instruction corruption, etc.)</li>
<li>The <strong>Exploit</strong> stage describes how a given fault can be leveraged by an attacker to achieve a certain goal.</li>
<li>The <strong>Goal</strong> stage describes what can be achieved by an attacker. These goals may be very similar to goals achieved with the exploitation of a software vulnerability.</li>
</ul>
<p>At each stage there is a vast amount of available options and potential outcomes. The picture below presents by no means an exhaustive list. Nonetheless, it gives a <strong>peek in the kitchen</strong> for the amount of variables at play while conducting <strong>FI</strong> attacks.</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-with-names-new.png">
        <img src="/img/fimodel/raelize-fi-fault-model-with-names-new.png" width="1000px">
    </a>
</p>
<p>The choices made during the <strong>Activate</strong>, <strong>Inject</strong> and <strong>Glitch</strong> stage impact the options available in the <strong>Fault</strong>, <strong>Exploit</strong> and <strong>Goal</strong> stage. Therefore, it's extremely important to sufficiently explore the available options during the initial stages before ruling out a certain attack as not applicable. Suboptimal choices will likely lead to suboptimal results.</p>
<p>It's typically much easier to prove a <strong>FI</strong> attack is possible rather than proving it's impossible. Negative proofs may be even impossible&hellip;</p>
<h2 id="using-firm----describing-attacks">Using FIRM &ndash; Describing attacks</h2>
<p><strong>FIRM</strong> can be used for effectively describing <strong>FI</strong> attacks. We demonstrate it here using some real-world attacks as an example.</p>
<h4 id="bypassing-secure-boot-on-the-nintendo-switch">Bypassing Secure Boot on the Nintendo Switch</h4>
<p><a href="https://media.ccc.de/v/c4.openchaos.2018.06.glitching-the-switch"target="_blank">This publication</a> shows it's possible to bypass the <strong>Secure Boot</strong> feature of the Nintendo Switch using <strong>FI</strong>. The attacker used a home-made, FPGA-based, glitcher to inject glitches into the chip's voltage supply. The attack goal was to bypass the verification of the bootloader in order to extract the decryption keys for some of the contents stored in flash.</p>
<p>We can describe the attack using <strong>FIRM</strong>:</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-switch.png">
        <img src="/img/fimodel/raelize-fi-fault-model-switch.png" width="1000px">
    </a>
</p>
<p>As far as we know, details regarding the fault itself were never disclosed. From an offensive perspective this is not uncommon. Attackers are often not that interested in what exactly is affected within a chip. In the end, knowing the fault model itself is often not needed for reaching the goal.</p>
<p>Nonetheless, a better understanding of the faults at play gives way to more powerful attacks, which will become more relevant once manufacturers start hardening their devices.</p>
<h4 id="escalating-privileges-using-rowhammer">Escalating privileges using Rowhammer</h4>
<p><a href="https://googleprojectzero.blogspot.com/2015/03/exploiting-dram-rowhammer-bug-to-gain.html"target="_blank">This publication</a> from Google's Project Zero (P0) demonstrates how the <strong>Rowhammer</strong> vulnerability can be used to gain Linux Kernel privileges. The authors used software to trigger the hardware vulnerability in the DRAM chip in order to perform this <strong>FI</strong> attack.</p>
<p>Using <strong>FIRM</strong>, we can describe this <strong>FI</strong> attack as well:</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-rowhammer.png">
        <img src="/img/fimodel/raelize-fi-fault-model-rowhammer.png" width="1000px">
    </a>
</p>
<h2 id="using-firm----designing-defenses">Using FIRM &ndash; Designing defenses</h2>
<p><strong>FIRM</strong> can also be used from a <strong>defensive</strong> perspective. This can be useful while designing defenses against <strong>FI</strong> attacks.</p>
<p>The picture below shows how typical <strong>FI</strong> defenses can be actually connected to different <strong>FIRM</strong> stages. It should become more visible how different measures can play a different role in lowering the chance of success, depending the stage they are connected to.</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-countermeasures.png">
        <img src="/img/fimodel/raelize-fi-fault-model-countermeasures.png" width="1000px">
    </a>
</p>
<p>Manufacturers often consider <strong>FI</strong> specific defenses to lower the risk of <strong>FI</strong> attacks. <strong>FIRM</strong> allows them to consider what defense may be useful during what stage of a <strong>FI</strong> attack. Interestingly, some of the defenses applicable against <strong>FI</strong> attacks may not be specific to <strong>FI</strong> at all (e.g. software exploitation mitigations).</p>
<p>It's important to point out an interesting observation. For example, software mitigations do not affect <strong>FI</strong> attack until the <strong>Exploit</strong> stage is reached. This is both an advantage and a disadvantage. Because the <strong>Exploit</strong> stage occurs after the <strong>Fault</strong> stage, software mitigations are often tailored to a specific <strong>Fault Model</strong>. However, if not all possible <strong>Fault Models</strong> are known in advance, which is likely for a given target, then designing comprehensive software mitigations becomes not trivial at all. Having all the possible fault models by software mitigations may even be an impossible task per se.</p>
<p>Assuming the amount of applicable <strong>Fault Models</strong> is unknown, then effective defenses can only be implemented at the <strong>Inject</strong> or <strong>Glitch</strong> stage. The focus should shift from mitigating the exploitation to preventing or detecting the glitch before the hardware vulnerability is triggered at all.</p>
<p>There are many other interesting observations to be made. We leave this up to the reader for now. We will likely touch upon this observations ourselves at a later stage&hellip;</p>
<h2 id="using-firm----developing-attacks">Using FIRM &ndash; Developing attacks</h2>
<p><strong>FIRM</strong> can also be used to envision and reason about new and unexplored attack paths.</p>
<p>For instance, in the diagram below, the exploitation path is independent from the path taken to trigger the vulnerability. Different <strong>FI</strong> techniques trigger different vulnerabilities but result in the same type of fault. This allows for reusing the same exploit path across different attacks.</p>
<p style="text-align:center;">
	<a href="/img/fimodel/raelize-fi-fault-model-different-method-same-fault.png">
        <img src="/img/fimodel/raelize-fi-fault-model-different-method-same-fault.png" width="1000px">
    </a>
</p>
<p>Recently we came across an applicable example. The <strong>Secure Boot</strong> implementation of the ESP32 chip has been bypassed using both <strong>voltage glitches</strong> (<a href="https://limitedresults.com/2019/09/pwn-the-esp32-secure-boot/"target="_blank">reference</a>) and <strong>electromagnetic glitches</strong> (<a href="https://raelize.com/posts/espressif-systems-esp32-bypassing-sb-using-emfi/"target="_blank">reference</a>). It's likely both attack trigger different hardware vulnerabilities but still use a similar path for exploitation.</p>
<p>Another interesting example is the <a href="https://arxiv.org/pdf/1912.11523.pdf"target="_blank">JackHammer</a> attack, where the Rowhammer vulnerability is triggered from an embedded FPGA instead of software. Effectively, the only difference between this attack and P0's Rowhammer attack is the <strong>Activate</strong> stage. All the remaining stages are applicable and can be reused.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We believe <strong>FIRM</strong> is useful for discussing <strong>FI</strong> attacks and defenses in a systematic manner. We are confident it can be used to progress both the offensive and defensive <strong>FI</strong> playing field. Nonetheless, we are aware that there is room for improvement and we are open to your remarks and/or contributions.</p>
<p>You can expect new <strong>FI</strong> research soon where we are going use <strong>FIRM</strong> again. Stay tuned!</p>
</article></div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/posts/espressif-systems-esp32-controlling-pc-during-sb/"><span class="iconfont icon-article"></span>Espressif ESP32: Controlling PC during Secure Boot</a></p><p><a class="link" href="/posts/espressif-systems-esp32-bypassing-sb-using-emfi/"><span class="iconfont icon-article"></span>Espressif ESP32: Bypassing Secure Boot using EMFI</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">Â©2020 Raelize</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135892271-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</body>

</html>